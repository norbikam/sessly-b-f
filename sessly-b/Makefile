.PHONY: help install run test migrate shell clean deploy check lint

help:
	@echo "Sessly Backend - Available Commands"
	@echo "===================================="
	@echo ""
	@echo "Development:"
	@echo "  make install    - Install dependencies"
	@echo "  make run        - Start development server"
	@echo "  make shell      - Open Django shell"
	@echo "  make test       - Run all tests"
	@echo "  make migrate    - Apply database migrations"
	@echo ""
	@echo "Maintenance:"
	@echo "  make clean      - Remove cache files"
	@echo "  make check      - Check for issues"
	@echo "  make lint       - Run code linters"
	@echo ""
	@echo "Deployment:"
	@echo "  make deploy     - Deploy to production"
	@echo "  make static     - Collect static files"
	@echo ""

install:
	@echo "ğŸ“¦ Installing dependencies..."
	pip install --upgrade pip
	pip install -r requirements.txt
	@echo "âœ… Done!"

run:
	@echo "ğŸš€ Starting development server..."
	python3 manage.py runserver

migrate:
	@echo "ğŸ—ƒï¸  Creating and applying migrations..."
	python3 manage.py makemigrations
	python3 manage.py migrate
	@echo "âœ… Migrations applied!"

shell:
	@echo "ğŸš Opening Django shell..."
	python3 manage.py shell

test:
	@echo "ğŸ§ª Running tests..."
	python3 manage.py test --verbosity=2

test-users:
	@echo "ğŸ§ª Testing users app..."
	python3 manage.py test users --verbosity=2

test-businesses:
	@echo "ğŸ§ª Testing businesses app..."
	python3 manage.py test businesses --verbosity=2

clean:
	@echo "ğŸ§¹ Cleaning cache files..."
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ… Cleaned!"

check:
	@echo "ğŸ” Checking for issues..."
	python3 manage.py check

check-deploy:
	@echo "ğŸ” Checking deployment configuration..."
	python3 manage.py check --deploy

static:
	@echo "ğŸ“¦ Collecting static files..."
	python3 manage.py collectstatic --noinput

deploy:
	@echo "ğŸš€ Deploying to production..."
	vercel --prod

lint:
	@echo "ğŸ” Running linters..."
	@command -v flake8 >/dev/null 2>&1 && flake8 . || echo "âš ï¸  flake8 not installed"
	@command -v black >/dev/null 2>&1 && black --check . || echo "âš ï¸  black not installed"

format:
	@echo "âœ¨ Formatting code..."
	@command -v black >/dev/null 2>&1 && black . || echo "âš ï¸  black not installed (pip install black)"

superuser:
	@echo "ğŸ‘¤ Creating superuser..."
	python3 manage.py createsuperuser

seed:
	@echo "ğŸŒ± Seeding sample data..."
	python3 manage.py seed_sample_business

logs:
	@echo "ğŸ“‹ Viewing logs..."
	tail -f logs/app.log

showmigrations:
	@echo "ğŸ“‹ Showing migration status..."
	python3 manage.py showmigrations

flush:
	@echo "âš ï¸  Flushing database..."
	python3 manage.py flush

setup:
	@echo "ğŸ”§ Running setup script..."
	./setup.sh
